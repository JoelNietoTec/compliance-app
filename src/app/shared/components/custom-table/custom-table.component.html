<app-loading-modal *ngIf="!options.items"></app-loading-modal>
<ng-container *ngIf="options.items">
  <h4>{{ options.title }}</h4>
  <div class="row justify-content-between justify-content-end top-bar">
    <div *ngIf="options.searcheable" class="col-md-4">
      <div class="form-group search-form">
        <div class="inner-addon left-addon">
          <i class="fa fa-search text-muted" aria-hidden="true"></i>
          <input type="text" class="form-control" name="filter" id="filter" [(ngModel)]="_searchText" (ngModelChange)="filterItems()"
            placeholder="BÃºsqueda">
        </div>
      </div>
    </div>
    <div *ngIf="options.newURL" class="col-md-4">
      <a [routerLink]="options.newURL" class="btn btn-outline-primary pull-right">
        <i class="fa fa-plus-circle" aria-hidden="true"></i> Nuevo elemento</a>
    </div>
  </div>
  <table class="table" [ngClass]="options.style" *ngIf="_pagedItems">
    <thead>
      <tr>
        <th *ngFor="let header of options.columns" (click)="sortByColumn(header)" [ngClass]="{'text-center': header.type == 'checkbox'}">
          {{ header.title }}
          <i class="fa" [ngClass]="{
              'fa-sort': _sortColumn != header.name,
              'fa-sort-desc': _sortColumn === header.name && _sortDesc,
              'fa-sort-asc': _sortColumn === header.name && !_sortDesc
            }" aria-hidden="true"></i>
        </th>
        <th *ngIf="options.editable || options.detailsURL" class="text-center">Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngIf="!_pagedItems.length">
        <td class="text-center" [colSpan]="options.columns.length + 1">
          Sin elementos disponibles
        </td>
      </tr>
      <ng-container *ngFor="let item of _pagedItems">
        <tr *ngIf="item.ID != _selectedItem.ID" (dblclick)="selectItem(item)">
          <td *ngFor="let col of options.columns" [ngClass]="{'text-center': col.type == 'checkbox'}">
            <ng-container [ngSwitch]="col.type">
              <ng-container *ngSwitchCase="'date'">
                {{ item | column: col.name | date: 'mediumDate' }}
              </ng-container>
              <ng-container *ngSwitchCase="'decimal'">
                {{ item | column: col.name | number: '1.3-3' }}
              </ng-container>
              <ng-container *ngSwitchCase="'number'">
                {{ item | column: col.name | number: '1.2-2' }}
              </ng-container>
              <ng-container *ngSwitchCase="'boolean'">
                <span [innerHTML]="item | column: col.name | boolean"></span>
              </ng-container>
              <ng-container *ngSwitchCase="'checkbox'">
                <span [innerHTML]="item | column: col.name | boolean"></span>
              </ng-container>
              <ng-container *ngSwitchCase="'object'">
                {{ item | column: col.objectColumn }}
              </ng-container>
              <ng-container *ngSwitchDefault>
                {{ item | column: col.name }}
              </ng-container>
            </ng-container>
          </td>
          <td *ngIf="options.editable || options.detailsURL" class="text-center">
            <i *ngIf="options.detailsURL" class="fa fa-search-plus fa-lg text-primary" [routerLink]="getDetailsURL(item.ID)" placement="top"
              ngbTooltip="Detalles"></i>
            <i *ngIf="options.editable" class="fa fa-edit fa-lg text-success" (click)="selectItem(item)" placement="top" ngbTooltip="Editar"></i>
            <i *ngIf="removeItem.observers.length" class="fa fa-trash-o fa-lg text-danger" [swal]="_deleteMessage" (confirm)="deleteItem(item.ID)"
              placement="top" ngbTooltip="Eliminar"></i>
          </td>
        </tr>
        <tr class="table-info" *ngIf="item.ID === _selectedItem.ID">
          <td *ngFor="let col of options.columns" [ngClass]="{'text-center': col.type == 'checkbox'}">
            <ng-container *ngIf="!col.readonly" [ngSwitch]="col.type">
              <input *ngSwitchCase="'checkbox'" [checked]="_selectedItem[col.name]" class="form-control" type="{{ col.type }}" (change)="_selectedItem[col.name] = !_selectedItem[col.name]">
              <input *ngSwitchDefault class="form-control" type="{{ col.type }}" [(ngModel)]="_selectedItem[col.name]" placeholder="{{ col.title }}">
              <select *ngSwitchCase="'object'" class="form-control custom-select" [(ngModel)]="_selectedItem[col.objectID]" [name]="col.name"
                [id]="col.name">
                <option *ngFor="let val of col.list" [value]="val[col.listID]">
                  {{ val[col.listDisplay] }}
                </option>
              </select>
            </ng-container>
            <ng-container *ngIf="col.readonly" [ngSwitch]="col.type">
              <ng-container *ngSwitchCase="'date'">
                {{ item | column: col.name | date: 'mediumDate' }}
              </ng-container>
              <ng-container *ngSwitchCase="'decimal'">
                {{ item | column: col.name | number: '1.3-3' }}
              </ng-container>
              <ng-container *ngSwitchCase="'boolean'">
                <span [innerHTML]="item | column: col.name | boolean"></span>
              </ng-container>
              <ng-container *ngSwitchCase="'checkbox'">
                <span [innerHTML]="item | column: col.name | boolean"></span>
              </ng-container>
              <ng-container *ngSwitchCase="'object'">
                {{ item | column: col.objectColumn }}
              </ng-container>
              <ng-container *ngSwitchDefault>
                {{ item | column: col.name }}
              </ng-container>
            </ng-container>
          </td>
          <td class="text-center">
            <i class="fa fa-lock fa-lg text-success" (click)="updateItem()" aria-hidden="true" placement="top" ngbTooltip="Guardar Cambios"></i>
            <i class="fa fa-times fa-lg text-danger" (click)="cancelSelect()" aria-hidden="true" placement="top" ngbTooltip="Cancelar"></i>
          </td>
        </tr>
      </ng-container>
      <tr *ngIf="options.editable && options.addMethod == 'inline'">
        <td *ngFor="let col of options.columns">
          <ng-container *ngIf="!col.readonly" [ngSwitch]="col.type">
            <select *ngSwitchCase="'object'" class="form-control custom-select" [(ngModel)]="_newItem[col.objectID]" [name]="col.name"
              [id]="col.name">
              <option value="undefined" disabled>--- Seleccionar ---</option>
              <option *ngFor="let val of col.list" [value]="val[col.listID]">
                {{ val[col.listDisplay] }}
              </option>
            </select>
            <input *ngSwitchDefault class="form-control" type="{{ col.type }}" [(ngModel)]="_newItem[col.name]" placeholder="{{ col.title }}">
          </ng-container>
        </td>
        <td class="text-center">
          <i class="fa fa-plus-square fa-lg text-primary" (click)="createItem()" placement="top" ngbTooltip="Agregar elemento" aria-hidden="true"></i>
        </td>
      </tr>
    </tbody>
  </table>
  <ng-container *ngIf="options.pageable">
    <app-paginator [itemsCount]="_itemsCount" (paginate)="setPage($event)"></app-paginator>
  </ng-container>
</ng-container>
